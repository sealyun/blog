(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{370:function(s,a,e){"use strict";e.r(a);var t=e(0),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"scratch镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#scratch镜像"}},[s._v("#")]),s._v(" scratch镜像")]),s._v(" "),e("p",[s._v("很容器想到from scratch, 就是没任何基础镜像")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('FROM scratch\nCOPY p /\nENTRYPOINT ["/p"]\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),s._v(" "),e("p",[s._v("有几点要注意：")]),s._v(" "),e("ul",[e("li",[s._v("ENTRYPOINT 或者CMD 必须要用[]这种模式，如果直接/p会用sh去启动，而scratch没有shell导致失败")]),s._v(" "),e("li",[s._v("二进制程序必须静态编译，也就是不能依赖libc什么的动态库")])]),s._v(" "),e("p",[s._v("动态编译的bin程序：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[root@dev-86-205 ci-sftp]# ldd p\n    linux-vdso.so.1 =>  (0x00007ffd6ef7b000)\n    libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fa28f94e000)\n    libc.so.6 => /lib64/libc.so.6 (0x00007fa28f58d000)\n    /lib64/ld-linux-x86-64.so.2 (0x00007fa28fb72000)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("这种情况下出来的bin程序可能会出现问题：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('standard_init_linux.go:175: exec user process caused "no such file or directory”\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("静态编译的bin程序,这是我们scratch需要的：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[root@dev-86-205 ci-sftp]# ldd p\n    不是动态可执行文件\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("golang中静态编译命令：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("go build --ldflags '-linkmode external -extldflags \"-static”'\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("如果不静态编译那可能得拷贝一堆动态库到镜像中，很多lowB就是那么做的")])])}),[],!1,null,null,null);a.default=n.exports}}]);