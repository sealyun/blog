# kuberentes ç¦»çº¿ä¸æ»‘å®‰è£…

ä¸ºäº†è®©kuberneteså®‰è£…ä¸é›†ç¾¤èŠ‚ç‚¹ç®¡ç†æ›´ä¸æ»‘ï¼Œè¿™æ¬¡æˆ‘ä»¬æ˜¯èŠ±äº†å¤§åŠŸå¤«ã€‚è¿™æ¬¡åšäº†å¾ˆå¤šéå¸¸å¤§çš„æ›´æ–°ï¼Œå¹¶ç»è¿‡å……åˆ†æµ‹è¯•ä¸bugä¿®å¤è®©å…¶ç¨³å®šã€‚

åŠ›äº‰æŠŠè¿™ä¸ªç®€å•çš„äº‹åšåˆ°æè‡´ã€‚

> å‰¥ç¦»å®šåˆ¶kubeamåŠŸèƒ½åˆ°sealosä¸­
 
ä¹‹å‰å®šåˆ¶kubeadmä»£ç å®ç°çš„100å¹´è¯ä¹¦åŠŸèƒ½å’ŒlocalLB,å·²ç»å…¨éƒ¨å‰¥ç¦»åˆ°sealosä¸­ï¼Œç°åœ¨å·²ç»æ˜¯å®Œå®Œå…¨å…¨åŸç”Ÿçš„kubernetesäº†ã€‚

ä¸ºäº†å‡å°‘å¯¹ç¬¬ä¸‰æ–¹å‘½ä»¤è¡Œå·¥å…·çš„ä¾èµ–ï¼Œsealosè¯ä¹¦å®Œå…¨æ˜¯é€šè¿‡è°ƒç”¨golangçš„åº“ç”Ÿæˆï¼Œç”Ÿæˆé€»è¾‘ä¸kubeadmä¿æŒä¸€è‡´ï¼Œä¸è¿‡æŠŠclient-goä¸­å†™æ­»ä¸€å¹´çš„è¯ä¹¦æ—¶é—´å˜æˆäº†ä¸€ä¸ªå‚æ•°ã€‚

ipvsçš„localLBæ–­ç„¶ä¹Ÿä¸å±‘äºå»è°ƒç”¨ç±»ä¼¼ipvsadmçš„å·¥å…·ï¼Œä¹Ÿæ˜¯èµ°ç³»ç»Ÿè°ƒç”¨å®Œæˆï¼Œè¿˜é¡ºä¾¿ä¿®å¤äº†netlinkå’Œå†…æ ¸ç‰ˆæœ¬ä¸å…¼å®¹çš„é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜1.18ç‰ˆæœ¬çš„kube-proxyç›®å‰ä¸€ç›´å­˜åœ¨éœ€è¦å‡çº§å†…æ ¸è§£å†³ã€‚

> è‡ªç”±çš„å¢åŠ åˆ é™¤masteræˆ–nodeèŠ‚ç‚¹

ç»Ÿç»Ÿä¸€æ¡å‘½ä»¤çš„äº‹ï¼Œéš¾é“æ‰¾åˆ°å…¶å®ƒçš„å¦‚æ­¤ä¸æ»‘ç®€å•çš„æ–¹å¼å¢åˆ ä½ é›†ç¾¤ä¸­çš„èŠ‚ç‚¹äº†

> è¶…å…¨çš„kubernetesç‰ˆæœ¬æ”¯æŒ

åŸºæœ¬å®˜æ–¹releaseçš„æ­£å¼ç‰ˆæˆ‘ä»¬éƒ½ä¼šåœ¨1ä¸ªå·¥ä½œæ—¥å†…å‘å¸ƒç¦»çº¿åŒ…ã€‚ æ‰€ä»¥åŸºæœ¬æ˜¯å…¨ç½‘æœ€å¿«æœ€å…¨ï¼Œè€Œä¸”ä¸ºäº†ç”¨æˆ·æœ‰æ›´å¥½çš„ä¸‹è½½ä½“éªŒï¼Œæ”¾åˆ°é˜¿é‡Œäº‘ossä¸Šäº†,ä¸‹è½½ä¸æ»‘ã€‚

ä¹‹æ‰€ä»¥æˆ‘ä»¬è¿™ä¹ˆå¿«å¾—ç›Šäºæˆ‘ä»¬çš„æ‰“åŒ…å’Œè‡ªåŠ¨åŒ–æµ‹è¯•æœºå™¨äººã€‚

> ä½“éªŒä¼˜åŒ–å†ä¼˜åŒ–

* ç²¾ç®€æ—¥å¿—è¾“å‡º
* å®æ—¶æµæ—¥å¿—ï¼Œå¤§éƒ¨åˆ†è¿œç¨‹æ‰§è¡Œå‘½ä»¤çš„å·¥å…·æ—¥å¿—éƒ½æ˜¯åŒæ­¥è¾“å‡ºï¼Œå°±æ˜¯ç­‰åˆ°æ—¥å¿—æ‰§è¡Œå®Œå†è¿”å›ç»™æ ‡å‡†è¾“å‡ºï¼Œè€Œsealosæ‰§è¡Œè¿œç¨‹å‘½ä»¤æ—¶å¼‚æ­¥è¾“å‡ºï¼Œè¿™å°±ä¸æ»‘å¤ªå¤šäº†ã€‚
* lvscareå¼€æœºipvså†…æ ¸æ¨¡å—åŠ è½½

## ğŸš€ å¿«é€Ÿå¼€å§‹

> ç¯å¢ƒä¿¡æ¯

ä¸»æœºå|IPåœ°å€
---|---
master0|192.168.0.2 
master1|192.168.0.3 
master2|192.168.0.4 
node0|192.168.0.5 

æœåŠ¡å™¨å¯†ç ï¼š123456

> åªéœ€è¦å‡†å¤‡å¥½æœåŠ¡å™¨ï¼Œåœ¨ä»»æ„ä¸€å°æœåŠ¡å™¨ä¸Šæ‰§è¡Œä¸‹é¢å‘½ä»¤å³å¯

```sh
# ä¸‹è½½å¹¶å®‰è£…sealos, sealosæ˜¯ä¸ªgolangçš„äºŒè¿›åˆ¶å·¥å…·ï¼Œç›´æ¥ä¸‹è½½æ‹·è´åˆ°binç›®å½•å³å¯, releaseé¡µé¢ä¹Ÿå¯ä¸‹è½½
$ wget -c https://sealyun.oss-cn-beijing.aliyuncs.com/latest/sealos && \
    chmod +x sealos && mv sealos /usr/bin 

# ä¸‹è½½ç¦»çº¿èµ„æºåŒ…
$ wget -c https://sealyun.oss-cn-beijing.aliyuncs.com/d551b0b9e67e0416d0f9dce870a16665-1.18.0/kube1.18.0.tar.gz 

# å®‰è£…ä¸€ä¸ªä¸‰masterçš„kubernetesé›†ç¾¤
$ sealos init --passwd 123456 \
	--master 192.168.0.2  --master 192.168.0.3  --master 192.168.0.4  \
	--node 192.168.0.5 \
	--pkg-url /root/kube1.18.0.tar.gz \
	--version v1.18.0
```

> å‚æ•°å«ä¹‰

å‚æ•°å|å«ä¹‰|ç¤ºä¾‹
---|---|---
passwd|æœåŠ¡å™¨å¯†ç |123456
master|k8s masterèŠ‚ç‚¹IPåœ°å€| 192.168.0.2
node|k8s nodeèŠ‚ç‚¹IPåœ°å€|192.168.0.3
pkg-url|ç¦»çº¿èµ„æºåŒ…åœ°å€ï¼Œæ”¯æŒä¸‹è½½åˆ°æœ¬åœ°ï¼Œæˆ–è€…ä¸€ä¸ªè¿œç¨‹åœ°å€|/root/kube1.16.0.tar.gz
version|[èµ„æºåŒ…](http://store.lameleg.com)å¯¹åº”çš„ç‰ˆæœ¬|v1.16.0

> å¢åŠ master

```shell script
ğŸ³ â†’ sealos join --master 192.168.0.6 --master 192.168.0.7
ğŸ³ â†’ sealos join --master 192.168.0.6-192.168.0.9  # æˆ–è€…å¤šä¸ªè¿ç»­IP
```

> å¢åŠ node

```shell script
ğŸ³ â†’ sealos join --node 192.168.0.6 --node 192.168.0.7
ğŸ³ â†’ sealos join --node 192.168.0.6-192.168.0.9  # æˆ–è€…å¤šä¸ªè¿ç»­IP
```
> åˆ é™¤æŒ‡å®šmasterèŠ‚ç‚¹

```shell script
ğŸ³ â†’ sealos clean --master 192.168.0.6 --master 192.168.0.7
ğŸ³ â†’ sealos clean --master 192.168.0.6-192.168.0.9  # æˆ–è€…å¤šä¸ªè¿ç»­IP
```

> åˆ é™¤æŒ‡å®šnodeèŠ‚ç‚¹

```shell script
ğŸ³ â†’ sealos clean --node 192.168.0.6 --node 192.168.0.7
ğŸ³ â†’ sealos clean --node 192.168.0.6-192.168.0.9  # æˆ–è€…å¤šä¸ªè¿ç»­IP
```

> æ¸…ç†é›†ç¾¤

```shell script
ğŸ³ â†’ sealos clean
```